<!--
  ~ eID PKI RA Project.
  ~ Copyright (C) 2010-2014 FedICT.
  ~
  ~ This is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU Lesser General Public License version
  ~ 3.0 as published by the Free Software Foundation.
  ~
  ~ This software is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  ~ Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public
  ~ License along with this software; if not, see
  ~ http://www.gnu.org/licenses/.
  -->

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" template="/layout/template.xhtml">

	<ui:define name="center">
		<h:form id="contractListForm">
			<rich:panel id="contractPanel">
				<f:facet name="header">
					<h:outputText value="#{messages['contracts.title']}" />
				</f:facet>

				<s:decorate id="certificateDomainDecorator" template="/layout/edit.xhtml">
	           		<ui:define name="label">#{messages['certificate.domain.selection.label']}:</ui:define>
					<h:selectOneMenu id="selectRegisteredCertificateDomain" value="#{contractWSQuery.certificateDomainId}" required="true">
						<s:selectItems value="#{certificateDomainWSQuery.findRegisteredCertificateDomains}"
								var="certificateDomain" label="#{certificateDomain.name}" itemValue="#{certificateDomain.id}"
								noSelectionLabel="#{messages['general.noselectionlabel']}" />
						<a:support event="onchange" reRender="contractTable,certificateDomainDnExpression" />
					</h:selectOneMenu>
	           	</s:decorate>

				<s:decorate id="dnExpressionDecorator" template="/layout/edit.xhtml">
					<ui:define name="label">#{messages['certificatedomain.dnExpression']}:</ui:define>
					<h:outputText id="certificateDomainDnExpression" value="#{contractWSQuery.certificateDomainExpressionShortened}" title="#{contractWSQuery.certificateDomainExpression}"/>
				</s:decorate>

				<rich:dataTable id="contractTable" var="contract" rows="#{contractWSQuery.rows}"
						value="#{contractWSQuery.findContracts}"
						reRender="contractTableDataScroller" width="75%">

					<rich:column sortBy="#{messages[contract.contractType.messageKey]}" filterBy="#{messages[contract.contractType.messageKey]}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputText value="#{messages['contract.type']}" />
						</f:facet>
						<h:outputText value="#{messages[contract.contractType.messageKey]}" />
					</rich:column>

					<rich:column sortBy="#{contract.requesterName}" filterBy="#{contract.requesterName}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputText value="#{messages['contract.requestername']}" />
						</f:facet>
						<h:outputText value="#{contract.requesterName}" />
					</rich:column>

					<rich:column sortBy="#{messages[contract.certificateType.messageKey]}" filterBy="#{messages[contract.certificateType.messageKey]}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputText value="#{messages['certificate.type']}" />
						</f:facet>
						<h:outputText value="#{messages[contract.certificateType.messageKey]}" />
					</rich:column>

					<rich:column sortBy="#{contract.dnExpression}" filterBy="#{contract.dnExpression}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputText value="#{messages['contract.dnexpression']}" />
						</f:facet>
						<h:outputText value="#{contract.dnExpression}" />
					</rich:column>

					<rich:column sortBy="#{contract.creationDate}">
						<f:facet name="header">
							<h:outputText value="#{messages['contract.creationdate']}" />
						</f:facet>
						<h:outputText value="#{contract.creationDate}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="Europe/Brussels" />
						</h:outputText>
					</rich:column>

					<rich:column sortBy="#{contract.result}" filterBy="#{contract.result}">
						<f:facet name="header">
							<h:outputText value="#{messages['contract.result']}" />
						</f:facet>
						<h:outputText value="#{contract.result}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
							<h:outputText value="#{messages['contract.resultMessage']}" />
						</f:facet>
						<h:outputText value="#{contract.resultMessage}" />
					</rich:column>

					<rich:column>
						<s:link id="downloadContractDocument" view="/page/contract/contract-download.xhtml" value="#{messages['link.download']}">
							<f:param name="contractId" value="#{contract.id}" />
						</s:link>
						<h:outputText value=" " />
						<s:link id="certificateDetail" view="/page/certificates/certificate-detail.xhtml" value="#{messages['link.detail']}" rendered="#{contract.hasCertificate}">
							<f:param name="certificateId" value="#{contract.certificateId}" />
						</s:link>
					</rich:column>

					<f:facet name="footer">
						<rich:datascroller id="contractTableDataScroller" for="contractTable" renderIfSinglePage="false"
								maxPages="#{contractWSQuery.maxPages}" fastStep="#{contractWSQuery.fastStep}" />
					</f:facet>
				</rich:dataTable>
			</rich:panel>
		</h:form>
	</ui:define>
</ui:composition>